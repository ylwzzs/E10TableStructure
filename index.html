
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>表结构多维筛选索引</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { padding: 2rem; }
        .table-hover tbody tr:hover { background: #f5f5f5; }
        .modal-dialog { max-width: 900px; }
        .field-table th, .field-table td { font-size: 0.95rem; }
        .filter-row { margin-bottom: 1rem; }
        .filter-label { min-width: 80px; }
    </style>
</head>
<body>
    <h1>表结构多维筛选索引</h1>
    <div class="row filter-row">
        <div class="col-md-2">
            <label class="filter-label">模块/微服务</label>
            <select id="moduleFilter" class="form-select"><option value="">全部</option></select>
        </div>
        <div class="col-md-2">
            <label class="filter-label">所属数据库</label>
            <select id="dbFilter" class="form-select"><option value="">全部</option></select>
        </div>
        <div class="col-md-2">
            <label class="filter-label">中文名词</label>
            <input id="commentFilter" type="text" class="form-control" placeholder="模糊搜索">
        </div>
        <div class="col-md-2">
            <label class="filter-label">表名</label>
            <input id="nameFilter" type="text" class="form-control" placeholder="模糊搜索">
        </div>
        <div class="col-md-2">
            <label class="filter-label">描述</label>
            <input id="descFilter" type="text" class="form-control" placeholder="模糊搜索">
        </div>
    </div>
    <table class="table table-bordered table-hover" id="tableList">
        <thead class="table-light">
            <tr>
                <th>表名</th>
                <th>中文名词</th>
                <th>模块/微服务</th>
                <th>所属数据库</th>
                <th>描述</th>
                <th>跳转</th>
            </tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
    <script>
    let tables = [];
    fetch('all_tables.json')
      .then(res => res.json())
      .then(data => {
        tables = data;
        initFilters();
        renderTable();
      });

    function unique(arr) {
      return Array.from(new Set(arr.filter(x => x && x.trim())));
    }

    function initFilters() {
      // 模块/微服务
      let modules = unique(tables.map(t => t.module || ''));
      let moduleSel = document.getElementById('moduleFilter');
      modules.forEach(m => {
        let opt = document.createElement('option');
        opt.value = m; opt.textContent = m;
        moduleSel.appendChild(opt);
      });
      // 所属数据库
      let dbs = unique(tables.map(t => t.db_name || ''));
      let dbSel = document.getElementById('dbFilter');
      dbs.forEach(d => {
        let opt = document.createElement('option');
        opt.value = d; opt.textContent = d;
        dbSel.appendChild(opt);
      });
      // 事件
      moduleSel.onchange = renderTable;
      dbSel.onchange = renderTable;
      document.getElementById('commentFilter').oninput = renderTable;
      document.getElementById('nameFilter').oninput = renderTable;
      document.getElementById('descFilter').oninput = renderTable;
    }

    function renderTable() {
      let moduleVal = document.getElementById('moduleFilter').value;
      let dbVal = document.getElementById('dbFilter').value;
      let commentVal = document.getElementById('commentFilter').value.trim();
      let nameVal = document.getElementById('nameFilter').value.trim();
      let descVal = document.getElementById('descFilter').value.trim();
      let tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      tables.filter(t => {
        return (!moduleVal || (t.module || '') === moduleVal)
          && (!dbVal || (t.db_name || '') === dbVal)
          && (!commentVal || (t.table_comment || '').includes(commentVal))
          && (!nameVal || (t.table_name || '').includes(nameVal))
          && (!descVal || (t.description || '').includes(descVal));
      }).forEach(t => {
        let tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${t.table_name || ''}</td>
          <td>${t.table_comment || ''}</td>
          <td>${t.module || ''}</td>
          <td>${t.db_name || ''}</td>
          <td>${t.description || ''}</td>
          <td><a href="${t.file}" target="_blank" class="btn btn-sm btn-success">跳转</a></td>
        `;
        tbody.appendChild(tr);
      });
    }
    </script>
</body>
</html>
